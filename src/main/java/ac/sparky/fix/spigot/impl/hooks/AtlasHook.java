package ac.sparky.fix.spigot.impl.hooks;

import ac.sparky.fix.common.Matcher;
import ac.sparky.fix.spigot.Plugin;
import ac.sparky.fix.spigot.util.PunishmentUtil;
import cc.funkemunky.api.Atlas;
import cc.funkemunky.api.tinyprotocol.api.Packet;
import cc.funkemunky.api.tinyprotocol.listener.functions.PacketListener;
import cc.funkemunky.api.tinyprotocol.packet.in.WrappedInChatPacket;
import org.bukkit.event.EventPriority;

public class AtlasHook {

    private final PacketListener packetListener = Atlas.getInstance().getPacketProcessor().process(
            Plugin.getInstance(), EventPriority.LOWEST, packetInfo -> {

                WrappedInChatPacket wrapped = new WrappedInChatPacket(packetInfo.getPacket(), packetInfo.getPlayer());

                if (Matcher.getInstance().isInvalidJNDI(wrapped.getMessage())) {
                    packetInfo.setCancelled(true);
                    PunishmentUtil.punish(packetInfo.getPlayer());
                }

            }, Packet.Client.CHAT);

    public AtlasHook() {
        Plugin.getInstance().getLogger().info("Hooked into Atlas");
    }
}
